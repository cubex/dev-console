<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-tooltip/paper-tooltip.html">
<link rel="import" href="../cube-behavior/cube-text-content-behavior.html">
<link rel="import" href="mdi.html">

<!--
An element providing a solution to no problem in particular.

Example:

    <cube-icon></cube-icon>

Example:

    <cube-icon>
      <h2>Hello cube-icon</h2>
    </cube-icon>

@demo demo/index.html
@hero hero.svg
-->

<dom-module id="cube-icon" attributes="icon src size alt color background round">
  <template strip-whitespace>
    <style>
      :host {
        display: inline-flex;
        line-height: normal;
        box-sizing: content-box;
        border-color: var(--cube-icon-background-color);
        background-color: var(--cube-icon-background-color);
        color: var(--cube-icon-color);
        padding: var(--cube-icon-padding, 5px);
        width: var(--cube-icon-size, 24px);
        height: var(--cube-icon-size, 24px);
      }

      :host ::slotted(svg) {
        fill: currentColor;
      }

      :host([round]) {
        border-radius: 100%;
      }

      :host iron-icon {
        display: block;
        width: 100%;
        height: 100%;
      }
    </style>

    <template is="dom-if" if="[[_showIcon(icon,src)]]">
      <iron-icon icon="[[icon]]" src="[[src]]"></iron-icon>
    </template>

    <slot></slot>

    <template is="dom-if" if="[[alt]]">
      <paper-tooltip>[[alt]]</paper-tooltip>
    </template>
  </template>

  <script>
    Polymer(
      {
        is:            'cube-icon',
        properties:    {
          icon:       {
            type:               String,
            reflectToAttribute: true,
            observer:           '_iconChanged'
          },
          src:        {
            type:               String,
            reflectToAttribute: true
          },
          round:      {
            type:               Boolean,
            reflectToAttribute: true
          },
          alt:        {type: String, value: ''},
          size:       {
            type:     Number,
            observer: '_styleChanged'
          },
          color:      {
            type:     String,
            value:    '',
            observer: '_styleChanged'
          },
          background: {
            type:     String,
            value:    '',
            observer: '_styleChanged'
          }
        },
        attached:      function ()
                       {
                         if(this.getEffectiveChildren().length > 0)
                         {
                           // strip width/height from svg to allow it to scale to [[size]]
                           var svg = this.queryEffectiveChildren('svg');
                           if(svg)
                           {
                             svg.style.width = '100%';
                             svg.style.height = '100%';

                             if(svg.hasAttribute('width'))
                             {
                               svg.removeAttribute('width');
                             }

                             if(svg.hasAttribute('height'))
                             {
                               svg.removeAttribute('height');
                             }
                           }
                         }
                       },
        _styleChanged: function ()
                       {
                         var props = {
                           '--cube-icon-background-color': this.background,
                           '--cube-icon-color':            this.color
                         };
                         if(this.size)
                         {
                           props['--cube-icon-size'] = this.size + 'px';
                         }
                         this.updateStyles(props);
                       },
        _iconChanged:  function ()
                       {
                         if(this.icon)
                         {
                           var iconSplit = this.icon.split(':');
                           var iconGroup = iconSplit[0] === 'icons' ? 'iron' : iconSplit[0];
                           if(iconGroup === "mdi")
                           {
                             this.importHref(this.resolveUrl(iconGroup + '.html'));
                           }
                           else
                           {
                             this.importHref(this.resolveUrl('../iron-icons/' + iconGroup + '-icons.html'));
                           }
                         }
                       },
        _showIcon:     function (icon, src)
                       {
                         return icon || src;
                       },

        behaviors: [Polymer.CubeTextContentBehavior]
      }
    );
  </script>
</dom-module>
