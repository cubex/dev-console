<link rel="import" href="../../polymer/polymer.html">
<link rel="import" href="../../app-route/app-route.html">
<link rel="import" href="../../app-route/app-location.html">

<dom-module id="cubex-route" attributes="full-path project-id vendor-id app-id app-path query">
  <template>
    <app-location route="{{route}}"></app-location>
    <app-route route="[[route]]" pattern="/:vendor" active="{{_vendorActive}}"
               data="{{vendorRouteData}}" tail="{{_vendorTail}}" query-params="{{query}}"></app-route>
    <app-route route="[[_vendorTail]]" pattern="/:app" active="{{_appActive}}"
               data="{{appRouteData}}" tail="{{_appTail}}"></app-route>
  </template>
  <script>
    Polymer(
      {
        is:         'cubex-route',
        properties: {
          fullPath:  {type: String, notify: true, value: ''},
          projectId: {type: String, notify: true, value: ''},
          vendorId:  {type: String, notify: true, value: ''},
          appId:     {type: String, notify: true, value: ''},
          appPath:   {type: String, notify: true, value: ''},
          query:     {type: Object, notify: true, value: function () {return {};}}
        },

        observers:      ['_computeValues(route.path)'],
        _computeValues: function () {
          var project = window.location.host.match(/^(.+?)\./)[1];
          this.setProperties(
            {
              'fullPath':  this.route.path,
              'projectId': project === 'console' ? '' : project,
              'vendorId':  this._vendorActive ? this.vendorRouteData.vendor : '',
              'appId':     this._appActive ? this.appRouteData.app : '',
              'appPath':   this._appActive ? this._appTail.path : '',
              'query':     this.projectActive ? this.query : ''
            }
          );
        }
      }
    );
  </script>
</dom-module>
