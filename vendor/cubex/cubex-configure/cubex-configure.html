<link rel="import" href="../../polymer/polymer.html">
<link rel="import" href="../../cube-behavior/cube-i18n-behavior.html">
<link rel="import" href="../cubex-app/cubex-app-definition.html">
<link rel="import" href="../../iron-pages/iron-pages.html">
<link rel="import" href="../../cube-action/cube-action.html">
<link rel="import" href="./cubex-configure-item.html">
<link rel="import" href="../../cube-form/cube-form.html">

<dom-module id="cubex-configure" attributes="gaid">
  <template>
    <style>
      :host {
        display: block;
      }

      #wrapper {
        display: flex;
      }

      cubex-configure-item {
        margin-bottom: 15px;
      }
    </style>

    <cubex-app-definition app-data="{{appData}}" gaid="[[gaid]]"></cubex-app-definition>

    <h2>[[i18nResource(appData.Name)]] Settings</h2>

    <div id="wrapper">
      <!-- menu -->
      <div>
        <template is="dom-if" if="[[appData.Config]]">
          <cube-action icon="icons:settings" on-tap="_tapMenu" data-id="0"></cube-action>
        </template>
      </div>

      <!-- content -->
      <div>
        <iron-pages id="configPages" selected="0">
          <template is="dom-if" if="[[appData.Config]]">
            <cube-form id="form" method="post" action="/kubex/config/[[appData.VendorID]]/[[appData.AppID]]">
              <div>
                <template is="dom-repeat" items="[[appData.Config]]">
                  <cubex-configure-item definition="[[item]]"></cubex-configure-item>
                </template>
              </div>
              <button>Save</button>
            </cube-form>
          </template>
        </iron-pages>
      </div>
    </div>
  </template>
  <script>
    Polymer(
      {
        is:         'cubex-configure',
        properties: {
          gaid:    {type: String},
          appData: {type: Object}
        },

        _tapMenu: function (e)
                  {
                    this.$.configPages.select(e.target.getAttribute('data-id'));
                  },

        behaviors: [Polymer.CubeI18nBehavior]
      }
    );
  </script>
</dom-module>
