<link rel="import" href="../../polymer/polymer.html">
<link rel="import" href="cubex-theme-style.html">

<!--
An element to set the page theme

Example:

    <cubex-theme primary="cubex-blue" accent="cubex-navy" theme="dark"></cubex-theme>

@demo demo/index.html
-->

<dom-module id="cubex-theme">
  <template>
    <style>
      :host {
        color: var(--theme-text);
      }

      :host::before {
        display: block;
        position: absolute;
        right: 0;
        left: 0;
        height: 236px;
        content: "";
        background: var(--theme-400-color);
      }

      :host::after {
        display: block;
        position: fixed;
        z-index: -1;
        top: 0;
        right: 0;
        left: 0;
        bottom: 0;
        content: "";
        background: var(--theme-700-color);
      }
    </style>
    <slot></slot>
  </template>
  <script>
    Polymer(
      {
        is:             'cubex-theme',
        properties:     {
          primary: {type: String, value: 'cubex-navy', observer: '_updatePrimary'},
          accent:  {type: String, value: 'cubex-blue', observer: '_updateAccent'},
          theme:   {type: String, value: 'light', observer: '_updateTheme'}
        },
        _import:        function (type, name)
                        {
                          name = name.replace(/[^a-z0-9\-]/, '');
                          if(!name)
                          {
                            return;
                          }
                          var dom = this,
                            prefix = 'cubex-theme-' + type,
                            fullName = prefix + '-' + name;

                          this.importHref(
                            this.resolveUrl('styles/' + type + '/' + fullName + '.html'),
                            function ()
                            {
                              var oldCustomStyle = dom.querySelector('#' + prefix);
                              if(oldCustomStyle)
                              {
                                oldCustomStyle.parentNode.removeChild(oldCustomStyle);
                              }

                              var style = document.createElement('style');
                              style.setAttribute('include', fullName);

                              var customStyle = document.createElement('custom-style');
                              customStyle.id = prefix;
                              customStyle.appendChild(style);

                              dom.appendChild(customStyle);
                            }, null, true
                          );
                        },
        _updatePrimary: function (v)
                        {
                          if(v)
                          {
                            this._import('primary', v);
                          }
                        },
        _updateAccent:  function (v)
                        {
                          if(v)
                          {
                            this._import('accent', v);
                          }
                        },
        _updateTheme:   function (v)
                        {
                          if(v)
                          {
                            this._import('theme', v);
                          }
                        }
      }
    );
  </script>
</dom-module>
