<link rel="import" href="../../polymer/polymer.html">
<link rel="import" href="../../app-route/app-location.html">
<link rel="import" href="../../app-route/app-route.html">
<link rel="import" href="../../cube-behavior/cube-service-behavior.html">

<dom-module id="cubex-repath" attributes="in service gaid out">
  <template>
    <app-location route="{{route}}"></app-location>
    <app-route route="[[route]]" pattern="/:project" data="{{routeData}}" tail="{{routeTail}}"></app-route>
    <app-route route="[[routeTail]]" pattern="/:category" data="{{catData}}"></app-route>
    <app-route route="[[routeTail]]" pattern="/:vendor/:app" data="{{gaidData}}"></app-route>
  </template>

  <script>
    Polymer(
      {
        is:         'cubex-repath',
        properties: {
          'in':      {type: String},
          'service': {type: String},
          'gaid':    {type: String},
          'out':     {
            type:     String,
            notify:   true,
            computed: '_computePath(in,service,gaid,routeData.project,gaidData.vendor,gaidData.app,catData.category)'
          }
        },

        _computePath: function (inPath, service, gaid, project, vendor, app, category)
                      {
                        if(inPath && (service || project) && (category || gaid !== undefined || (vendor && app)))
                        {
                          var paths = [];
                          if(service)
                          {
                            paths.push('/' + this.getServiceHost(service));
                          }
                          else if(project)
                          {
                            paths.push(project);
                          }

                          if((gaid === undefined) && vendor && app)
                          {
                            gaid = vendor + '/' + app;
                          }
                          else if(category !== undefined && gaid === undefined)
                          {
                            paths.push(category);
                          }

                          if(gaid)
                          {
                            paths.push(gaid);
                          }
                          if(inPath)
                          {
                            paths.push(inPath.replace(/^\//, ''));
                          }

                          return '/' + paths.join('/');
                        }
                      },

        behaviors: [Polymer.CubeServiceBehavior]
      }
    );
  </script>
</dom-module>
