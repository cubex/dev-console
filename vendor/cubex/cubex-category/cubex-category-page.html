<link rel="import" href="../../polymer/polymer.html">
<link rel="import" href="../../cube-carousel/cube-carousel.html">
<link rel="import" href="../../cube-tile/cube-tile.html">
<link rel="import" href="../../cube-card/cube-card.html">
<link rel="import" href="../../cube-behavior/cube-service-behavior.html">

<dom-module id="cubex-category-page" attributes="category">
  <template>
    <style>
      :host {
        --cube-carousel-style: {
          overflow: hidden;
          margin: 20px -32px;
          background: var(--theme-400-color);
        };
      }

      :host cube-carousel {
        margin-top: -32px;
      }
    </style>

    <app-location route="{{route}}"></app-location>
    <app-route route="[[route]]" pattern="/:project" data="{{projectRouteData}}"></app-route>
    <cubex-registry project-data="{{projectData}}"></cubex-registry>

    <cube-carousel count="5">
      <template style="display:none" is="dom-repeat" items="[[_getCategories(projectData.AppSummary)]]">
        <a href="/[[projectRouteData.project]]/[[item.vendor_id]]/[[item.id]]">
          <cube-tile color="[[_getColor(index)]]" icon="[[item.icon]]" heading="[[item.name]]"
                     text="[[item.description]]"></cube-tile>
        </a>
      </template>
    </cube-carousel>

    <cube-pagelet auto auth url="//[[getServiceHost('apps')]]/cubex/cardfeed?category=[[category]]"></cube-pagelet>
  </template>
  <script>
    Polymer(
      {
        is:             'cubex-category-page',
        properties:     {
          category: {type: String}
        },
        _getCategories: function (appSummaries)
                        {
                          var cats = [];
                          for(var idx in appSummaries)
                          {
                            if(appSummaries.hasOwnProperty(idx) && appSummaries[idx].category == this.category)
                            {
                              cats.push(appSummaries[idx]);
                            }
                          }
                          console.log(cats);
                          return cats;
                        },
        _getColor:      function (idx)
                        {
                          var colors = ['pink', 'orange', 'teal', 'purple', 'light-green', 'red', 'green', 'blue'];
                          return colors[idx];
                        },
        behaviors:      [Polymer.CubeServiceBehavior]
      }
    );
  </script>
</dom-module>
