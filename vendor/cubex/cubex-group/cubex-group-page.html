<link rel="import" href="../../polymer/polymer.html">
<link rel="import" href="../../cube-carousel/cube-carousel.html">
<link rel="import" href="../../cube-tile/cube-tile.html">
<link rel="import" href="../../cube-card/cube-card.html">
<link rel="import" href="../../cube-behavior/cube-service-behavior.html">
<link rel="import" href="../cubex-route/cubex-route.html">

<dom-module id="cubex-group-page" attributes="group-id">
  <template>
    <style>
      :host {
        --cube-carousel-style: {
          overflow: hidden;
          margin: 20px -32px;
          background: var(--theme-400-color);
        };
      }

      :host cube-carousel {
        margin-top: -32px;
      }
    </style>

    <cubex-route project-id="{{projectId}}"></cubex-route>

    <cubex-registry project-data="{{projectData}}"></cubex-registry>

    <cube-carousel count="5">
      <template style="display:none" is="dom-repeat" items="[[_apps]]">
        <a href="/[[item.vendor_id]]/[[item.id]]">
          <cube-tile color="[[_getColor(index)]]" icon="[[item.icon]]" heading="[[item.name]]"
                     text="[[item.description]]"></cube-tile>
        </a>
      </template>
    </cube-carousel>

    <cube-pagelet auto auth url="//[[getServiceHost('apps')]]/kubex/cardfeed?category=[[category]]"></cube-pagelet>
  </template>
  <script>
    Polymer(
      {
        is:           'cubex-group-page',
        properties:   {
          groupId: {type: String},
          _apps:   {type: Array, computed: '_computeApps(projectData.AppSummary)'},
          _colors: {type: Array, value: ['pink', 'orange', 'teal', 'purple', 'light-green', 'red', 'green', 'blue']}
        },
        _computeApps: function (appSummary)
                      {
                        var apps = [];
                        for(var idx in appSummary)
                        {
                          if(appSummary.hasOwnProperty(idx) && appSummary[idx].group)
                          {
                            var groupId = appSummary[idx].vendor_id + '/' + appSummary[idx].group;
                            if(groupId === this.groupId)
                            {
                              apps.push(appSummary[idx]);
                            }
                          }
                        }
                        return apps;
                      },
        _getColor:    function (idx)
                      {
                        return this._colors[idx];
                      },
        behaviors:    [Polymer.CubeServiceBehavior]
      }
    );
  </script>
</dom-module>
